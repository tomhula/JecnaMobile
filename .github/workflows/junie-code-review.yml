name: Junie Code Review

on:
    # Use pull_request_target to allow access to secrets from fork PRs
    pull_request_target:
        types: [opened, synchronize]

jobs:
    review:
        runs-on: ubuntu-latest
        permissions:
            contents: read
            pull-requests: write
            issues: write
        steps:
            - uses: actions/checkout@v4
              with:
                  # Point to the fork's branch instead of the base branch
                  ref: ${{ github.event.pull_request.head.sha }}
                  # Ensure the checkout happens from the contributor's repo
                  repository: ${{ github.event.pull_request.head.repo.full_name }}
                  fetch-depth: 1

            - uses: JetBrains/junie-github-action@v0
              with:
                  junie_api_key: ${{ secrets.JUNIE_API_KEY }}
                  use_single_comment: true
                  prompt: "code-review"
